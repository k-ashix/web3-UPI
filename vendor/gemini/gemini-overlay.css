/* =========================================
   GEMINI OVERLAY - LOCKED GLASS SYSTEM
   Scoped to #gemini-overlay-root

   ARCHITECTURE:
   - Root: #gemini-overlay-root (Absolute, anchored to Shell)
   - Layout: Flexbox for collapsed, Absolute for expanded
   - Z-Index: 4000 (Must be > Send 3000)
   - Containment: Strict shell confinement (No viewport units)

   CRITICAL CONSTRAINTS:
   - Do NOT revert #gemini-overlay-root to position:fixed
   - Do NOT change z-index below 4000
   - Do NOT use viewport units (vh/vw) for dimensions
   - Do NOT add global blur to backdrop (double-blur risk)
========================================= */

#gemini-overlay-root {
    /* Token System (Local Scope) */
    --gemini-glass-bg: rgba(255, 255, 255, 0.65);
    /* Restored translucency */
    --gemini-glass-border: rgba(255, 255, 255, 0.4);
    --gemini-glass-blur: 24px;
    /* Restored blur for panel only */
    --gemini-text-primary: #1a1a1a;
    --gemini-text-secondary: #666666;
    --gemini-accent-glow: rgba(255, 255, 255, 0.8);
    --gemini-radius: 24px;
    --gemini-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.4);

    position: absolute;
    /* Contain to Shell (Was Fixed, moved to Absolute for Phase 1C) */
    inset: 0;
    z-index: 4000;
    /* CRITICAL: Must be above Send Overlay (z-index 3000) */
    display: flex;
    pointer-events: none;
    /* Pass-through when hidden */
    font-family: 'Inter', sans-serif;
    /* Default sans */
    border-radius: inherit;
    /* Clip to shell radius */
}

/* Visibility States */
#gemini-overlay-root.gemini-overlay-hidden {
    visibility: hidden;
}

#gemini-overlay-root.gemini-overlay-active {
    pointer-events: auto;
    visibility: visible;
}

/* =========================================
   BACKDROP
========================================= */
.gemini-backdrop {
    position: absolute;
    inset: 0;
    background: transparent;
    /* No dimming, completely clear */
    opacity: 0;
    /* REMOVED: background transition (to prevent darkening feel) */
    transition: opacity 0.3s ease;
    border-radius: inherit;
}

#gemini-overlay-root.gemini-overlay-active .gemini-backdrop {
    opacity: 1;
}

/* =========================================
   PANEL (THE GLASS CARD)
========================================= */
/* Centering for collapsed modes only */
.gemini-panel:not(.mode-full):not(.mode-collapsing) {
    margin: auto;
}

.gemini-panel {
    position: relative;
    width: 90%;
    max-width: 400px;
    background: var(--gemini-glass-bg);
    /* Glass Restored */
    backdrop-filter: blur(var(--gemini-glass-blur)) saturate(180%);
    -webkit-backdrop-filter: blur(var(--gemini-glass-blur)) saturate(180%);
    border-radius: var(--gemini-radius);
    border: 1px solid var(--gemini-glass-border);
    box-shadow: var(--gemini-shadow);

    /* Grain Texture via pseudo */
    overflow: hidden;

    /* Animation Initial State - UNIFIED PIPELINE */
    /* Start slightly small and lower */
    opacity: 0.98;
    transform-origin: top center;
    transform: translateY(8px) scale(0.98);

    /* Base Transition (Medium/Small modes) */
    transition: transform 0.38s cubic-bezier(0.4, 0, 0.2, 1),
        opacity 0.25s ease,
        box-shadow 0.38s ease;

    display: flex;
    flex-direction: column;
}

/* ... existing grain ... */

/* ... existing active state ... */

/* ... existing exit state ... */

/* =========================================
   MODES
========================================= */
.gemini-panel.mode-small {
    height: 200px;
}

.gemini-panel.mode-medium {
    height: 400px;
}

/* 
   EXPANDED MODE GEOMETRY
   Authority: Absolute positioning relative to #gemini-overlay-root
   Constraint: 100% width of Shell, Top-anchored
   Note: Height is fixed 65vh to preserve keyboard space at bottom
*/
.gemini-panel.mode-full,
.gemini-panel.mode-collapsing {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 65vh;
    /* Reserve bottom for keyboard */
    max-width: none;
    border-radius: 0 0 24px 24px;

    /* VISUAL DOMINANCE STRATEGY (illusion-based) */
    /* EXPANDED STATE TARGET */
    /* Single pass transform from base state */
    transform: translateY(0) scale(1.02);
    transform-origin: top center;

    /* Elevated depth perception */
    box-shadow:
        0 30px 90px rgba(0, 0, 0, 0.35),
        0 10px 40px rgba(0, 0, 0, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.5);

    /* CINEMATIC EXPAND ANIMATION */
    /* Long, smooth, film-grade easing */
    transition: transform 0.85s cubic-bezier(0.22, 1, 0.36, 1),
        opacity 0.4s ease,
        box-shadow 0.6s ease;

    /* Focused State Enhancements */
    opacity: 1;
    z-index: 2;
}

/* Icon Toggling Logic */
.gemini-expand-btn .icon-collapse {
    display: none;
}

.gemini-panel.mode-full .gemini-expand-btn .icon-expand {
    display: none;
}

.gemini-panel.mode-full .gemini-expand-btn .icon-collapse {
    display: block;
}



/* =========================================
   INTERNAL LAYOUT
========================================= */
.gemini-header,
.gemini-body,
.gemini-footer {
    position: relative;
    z-index: 1;
    /* Above grain */
    padding: 1.5rem;
}

.gemini-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 0.5rem;
}

.gemini-title {
    font-family: 'Playfair Display', serif;
    /* Match parent app vibe */
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--gemini-text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.gemini-subtitle {
    font-size: 0.8rem;
    color: var(--gemini-text-secondary);
    font-weight: 400;
    margin-top: 2px;
}

.gemini-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.gemini-close-btn,
.gemini-expand-btn {
    background: rgba(0, 0, 0, 0.05);
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    color: var(--gemini-text-secondary);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 0.2s;
}

.gemini-close-btn:hover,
.gemini-expand-btn:hover {
    background: rgba(0, 0, 0, 0.1);
}

.gemini-body {
    flex: 1;
    color: var(--gemini-text-primary);
    font-size: 1rem;
    line-height: 1.5;
    overflow-y: auto;
    scrollbar-width: thin;
}

.gemini-footer {
    padding-top: 0.5rem;
    display: flex;
    justify-content: flex-end;
    gap: 0.8rem;
}

/* =========================================
   BUTTONS - PREMIUM GLASS POLISH
========================================= */
.gemini-btn {
    padding: 0;
    width: 42px;
    height: 42px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    font-weight: 600;
    font-family: 'Inter', sans-serif;
    cursor: pointer;
    font-size: 0.9rem;
    opacity: 1;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: background-color 0.18s ease, color 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
    /* COLOR + SHADOW TRANSITIONS */
}

/* ────────────────────────
   SEND BUTTON (PRIMARY → GREEN GLASS)
──────────────────────── */
.gemini-btn.primary {
    background: linear-gradient(to bottom,
            rgba(0, 200, 83, 0.85),
            rgba(0, 200, 83, 0.75));
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.25);
    box-shadow:
        0 8px 18px rgba(0, 200, 83, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.35);
}

.gemini-btn.primary:hover,
.gemini-btn.primary:active {
    background: #00C853;
    /* Full green - keeps existing behavior */
    color: white;
    border-color: rgba(255, 255, 255, 0.25);
}

/* ────────────────────────
   STOP BUTTON (NEUTRAL GLASS → DANGER)
──────────────────────── */
.gemini-btn.secondary {
    background: rgba(255, 255, 255, 0.55);
    /* Translucent neutral glass */
    color: #1a1a1a;
    border: 1px solid rgba(255, 255, 255, 0.35);
    box-shadow:
        0 6px 16px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
}

/* STOP logic - Red on hover ONLY for non-mic */
.gemini-btn.secondary:not(.mic-btn):hover,
.gemini-btn.secondary:not(.mic-btn):active {
    background: #FF3B30;
    /* Red - existing behavior */
    color: white;
    border-color: #FF3B30;
    box-shadow:
        0 8px 18px rgba(255, 59, 48, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
}

/* MIC logic - Neutral/Subtle on hover */
.gemini-btn.secondary.mic-btn:hover,
.gemini-btn.secondary.mic-btn:active {
    background: rgba(255, 255, 255, 0.85);
    /* Brighter glass */
    color: #1a1a1a;
    border-color: rgba(255, 255, 255, 0.6);
}

/* MIC visually active state (placeholder) */
.gemini-btn.secondary.mic-btn.active {
    background: rgba(255, 255, 255, 0.9);
    border-color: var(--gemini-accent-glow);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
}

.gemini-btn.secondary.mic-btn.active svg {
    color: #000;
    /* Darker glyph when active */
    stroke-width: 2.5;
    /* Slightly bolder */
}

/* =========================================
   CLOSE ANIMATION (SYNCED)
   ========================================= */
.gemini-panel.gemini-closing,
.gemini-panel.gemini-closing * {
    transition:
        transform 0.28s cubic-bezier(0.4, 0, 0.2, 1),
        opacity 0.2s ease !important;
    pointer-events: none;
}

.gemini-panel.gemini-closing {
    opacity: 0;
    transform: translateY(10px) scale(0.98);
}

.gemini-panel.gemini-closing .gemini-footer {
    opacity: 0;
    transform: translateY(6px);
}